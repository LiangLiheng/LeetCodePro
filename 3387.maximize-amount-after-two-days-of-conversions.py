#\n# @lc app=leetcode id=3387 lang=python3\n#\n# [3387] Maximize Amount After Two Days of Conversions\n#\n\n# @lc code=start\nclass Solution:\n    def maxAmount(self, initialCurrency: str, pairs1: List[List[str]], rates1: List[float], pairs2: List[List[str]], rates2: List[float]) -> float:\n        currencies = {initialCurrency}\n        for pairs_ in (pairs1, pairs2):\n            for p in pairs_:\n                currencies.add(p[0])\n                currencies.add(p[1])\n        curr_list = list(currencies)\n        N = len(curr_list)\n        cur_to_idx = {curr: i for i, curr in enumerate(curr_list)}\n\n        def build_dist(pairs, rates):\n            dist = [[0.0] * N for _ in range(N)]\n            for i in range(N):\n                dist[i][i] = 1.0\n            for pair_idx in range(len(pairs)):\n                fr, to = pairs[pair_idx]\n                i_idx = cur_to_idx[fr]\n                j_idx = cur_to_idx[to]\n                r = rates[pair_idx]\n                dist[i_idx][j_idx] = max(dist[i_idx][j_idx], r)\n                dist[j_idx][i_idx] = max(dist[j_idx][i_idx], 1.0 / r)\n            \# Floyd-Warshall for max product\n            for k in range(N):\n                for i in range(N):\n                    for j in range(N):\n                        dist[i][j] = max(dist[i][j], dist[i][k] * dist[k][j])\n            return dist\n\n        dist1 = build_dist(pairs1, rates1)\n        dist2 = build_dist(pairs2, rates2)\n\n        start_idx = cur_to_idx[initialCurrency]\n        max_amt = 1.0\n        for c in range(N):\n            amt1 = dist1[start_idx][c]\n            mult2 = dist2[c][start_idx]\n            max_amt = max(max_amt, amt1 * mult2)\n        return max_amt\n\n# @lc code=end